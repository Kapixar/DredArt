!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Blitz=t()}}(function(){var t={};function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}return(t=t={resize:function(t,i){var a=this;if("object"!=e(t))throw Error("You need to provide options for Blitz as a `object`.");for(var n=["source"],r=0;r<n.length;r++){var o=n[r];if(void 0===t[o])throw Error("#resize() is expecting mandatory param `"+o+"`.")}if("function"!=typeof i)throw Error("#resize() is expecting `callback` to be a function.");var h,c,d=this._extract(t.source),s=this._mimeConverter(t.outputFormat);if(t.outputFormat=t.mimeType=s,"CANVAS"===d.type)h=d.source;else if("IMG"===d.type)h=this._imageToCanvas(d.source);else{if("DATA"===d.type)return t.output||(t.output="data"),this._dataToCanvas(d.source,t,i);if("FILE"===d.type)return t.output||(t.output="file"),this._fileToCanvas(d.source,t,i)}if(!h)throw Error("Unable to detect source type.");t.logPerformance&&(c=Date.now());var u=h.width,g=h.height,f=this._heightWidthCalc(g,u,t.height,t.width,t.maxHeight,t.maxWidth,t.minHeight,t.minWidth,t.proportional),l=f.width,m=f.height;if(f.width===u&&f.height===g)this._output(null,h,t,f,c,i);else{var p=h.getContext("2d").getImageData(0,0,u,g),w=h.getContext("2d").getImageData(0,0,l,m);h.getContext("2d").clearRect(0,0,u,g);var v=new Worker(this._workerBlobURL(t.filter));v.onmessage=function(e){a._output(e,h,t,f,c,i)},v.postMessage([p.data.buffer,u,g,l,m,w.data.buffer],[p.data.buffer,w.data.buffer])}},create:function(t){if(!t||"promise"===t){var e=(i=Object.create(this)).resize.bind(i);return function(t){return new Promise(function(i,a){try{e(t,function(t){i(t)})}catch(n){a(n)}})}}var i;if("callback"===t)return(i=Object.create(this)).resize.bind(i)},_output:function(t,e,i,a,n,r){var o,h=a.width,c=a.height;if(t){var d=new ImageData(new Uint8ClampedArray(t.data.data),h,c);i.logPerformance&&console.log("Resize completed in "+Math.round(Date.now()-n)/1e3+"s"),e.getContext("2d").clearRect(0,0,h,c),e.height=c,e.width=h,e.getContext("2d").putImageData(d,0,0)}if("canvas"===i.output)o=e;else if(["image","data"].indexOf(i.output)>-1)o=this._canvasToImageOrData(e,i.mimeType,i.quality,i.output);else if("file"===i.output)o=this._canvasToFile(e,i.mimeType,i.quality,i.output);else if("blob"===i.output)o=this._canvasToBlob(e,i.mimeType,i.quality,i.output);else if("download"===i.output)o=this._download(this,e,i);else{if(void 0!==i.output)throw Error("`output` is not valid.");var s;if("DATA"===sourceElement.type?s="data":"IMG"===sourceElement.type&&(s="image"),s)return this._canvasToImageOrData(e,i.mimeType,i.quality,s);o=e}return"function"==typeof r?r(o):o},_heightWidthCalc:function(t,e,i,a,n,r,o,h,c){var d={height:t,width:e};if(i&&a)return(n||r||o||o)&&console.warn("Warn: `min/maxHeight` or `min/maxWidth` are ignored when `height` and/or `width` are supplied."),c&&console.warn("Warn: `proportional` is ignored when both `height` and `width` are provided."),{height:i,width:a};if(null==c&&(c="defaulted true"),a)return(n||r||o||o)&&console.warn("Warn: `min/maxHeight` or `min/maxWidth` are ignored when `height` and/or `width` are supplied."),{width:a,height:c?this._scale(e,t,a):t};if(i)return(n||r||o||o)&&console.warn("Warn: `min/maxHeight` or `min/maxWidth` are ignored when `height` and/or `width` are supplied."),{height:i,width:c?this._scale(t,e,i):e};var s=[];if(o&&n&&o>n&&s.push("`minHeight` cannot be larger than `maxHeight."),h&&r&&h>r&&s.push("`minWidth` cannot be larger than `maxWidth."),s.length>0)throw Error(s.join(" "));if(r&&n&&r<e&&n<t){if(!1===c)return{width:r,height:n};var u={width:r,height:this._scale(e,t,r)},g={width:this._scale(t,e,n),height:n};return u.width*u.height<g.width*g.height?m(u,{minH:o},c):m(g,{minW:h},c)}if(r&&r<e)return m({width:r,height:c?this._scale(e,t,r):t},{minH:o},c);if(n&&n<t)return m({width:c?this._scale(t,e,n):e,height:n},{minW:h},c);if(h&&o&&h>e&&o>t){if(!1===c)return{width:h,height:o};var f={width:h,height:this._scale(e,t,h)},l={width:this._scale(t,e,o),height:o};return f.width*f.height>l.width*l.height?m(f,{maxH:n},c):m(l,{maxW:r},c)}return h&&h>e?m({width:h,height:c?this._scale(e,t,h):t},{maxH:n},c):o&&o>t?m({width:c?this._scale(t,e,o):e,height:o},{maxW:r},c):d;function m(t,e,i){var a=e.minH,n=e.minW,r=e.maxH,o=e.maxW,h="Warn: Unable to maintain image proportionality.";return a?t.height<a?(!0===i&&console.warn("".concat(h," Enforcing minHeight of ").concat(a," as scaling image to maxWidth of ").concat(t.width," gives scaled height of ").concat(t.height,".")),{height:a,width:t.width}):t:n?t.width<n?(!0===i&&console.warn("".concat(h," Enforcing minWidth of ").concat(n," as scaling image to maxHeight of ").concat(t.height," gives scaled width of ").concat(t.width,".")),{height:t.height,width:n}):t:r?t.height>r?(!0===i&&console.warn("".concat(h," Enforcing maxHeight of ").concat(r," as scaling image to minWidth of ").concat(t.width," gives scaled height of ").concat(t.height,".")),{height:r,width:t.width}):t:o&&t.width>o?(!0===i&&console.warn("".concat(h," Enforcing maxWidth of ").concat(o," as scaling image to minHeight of ").concat(t.height," gives scaled width of ").concat(t.width,".")),{height:t.height,width:o}):t}},_scale:function(t,e,i){return Math.round(i/(t/e))},_extract:function(t){if(t instanceof File)return{source:t,type:"FILE"};if("string"==typeof t&&0===t.indexOf("data"))return{source:t,type:"DATA"};if(t.tagName)return{source:t,type:t.tagName};if(t[0].tagName)return{source:t[0],type:t[0].tagName};throw Error("`source` element to be invalid.")},_imageToCanvas:function(t){var e=document.createElement("canvas"),i=e.getContext("2d");return e.height=t.height,e.width=t.width,i.drawImage(t,0,0,t.width,t.height),e},_dataToCanvas:function(t,e,i){var a=this,n=new Image;n.src=t,n.onload=function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.height=n.height,t.width=n.width,r.drawImage(n,0,0,n.width,n.height),e.output=e.output?e.output:"data",e.source=t,a.resize(e,i)}},_fileToCanvas:function(t,e,i){var a=this,n=new FileReader;n.onload=function(t){e.source=t.target.result,e.output||(e.output="file"),a.resize(e,i)},n.readAsDataURL(t)},_canvasToImageOrData:function(t,e,i,a){var n,r=t.toDataURL(e,i);return"data"===a?n=r:(n=new Image).src=t.toDataURL(e,i),n},_canvasToBlob:function(t,e,i,a){var n=this._canvasToImageOrData(t,e,i,"data");return this._dataURItoBlob(n)},_canvasToFile:function(t,e,i,a){var n=this._canvasToBlob(t,e,i);return new File([n],"resized",{type:e,lastModified:Date.now()})},_dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(e.length),n=0;n<e.length;n++)a[n]=e.charCodeAt(n);return new Blob([a],{type:i})},_mimeConverter:function(t,e){if(void 0===t)return"image/png";var i=["raw","png","jpg","gif","image/raw","image/png","image/jpeg","image/gif"].indexOf(t);if(-1===i)throw Error("mimeType can only be `raw`, `png`, `jpg` or `gif`");return 0===i||1===i?"image/png":2===i?"image/jpeg":3===i?"image/gif":t},_download:function(t,e,i){return function(){var a=document.createElement("a");a.href=t._canvasToImageOrData(e,i.mimeType,i.quality,"data"),a.download="image/jpeg"===i.mimeType?"resized.jpg":"resized",document.body.appendChild(a),a.click(),document.body.removeChild(a)}},_workerBlobURL:function(t){t&&(t=this["_filter_"+t]),t||(t=this._filter_hermite);var e=this._workerTaskString(t);return window.URL.createObjectURL(new Blob([e],{type:"application/javascript"}))},_workerTaskString:function(t){var e="";return e+="(",e+="function () {",e+="    onmessage = function (event) {",e+="        var filter = ",e+=t.toString(),e+="        ;var resized = filter(event)",e+="        ;postMessage({data: resized }, [ resized ]);",e+="    };",(e+="}")+")()"},addFilter:function(t){var e="_filter_".concat(t.name);if(this[e])throw Error("Filter name already exist for ".concat(t.name,". Please use another name."));return this[e]=t.filter,this}}).addFilter({name:"hermite",filter:function(t){for(var e=new Uint8ClampedArray(t.data[0]),i=t.data[1],a=t.data[2],n=(new ImageData(e,i,a),new Uint8ClampedArray(t.data[5])),r=t.data[3],o=t.data[4],h=new ImageData(n,r,o),c=i/r,d=a/o,s=Math.ceil(c/2),u=Math.ceil(d/2),g=0;g<o;g++)for(var f=0;f<r;f++){for(var l=4*(f+g*r),m=0,p=0,w=gx_g=gx_b=gx_a=0,v=(g+.5)*d,y=Math.floor(g*d);y<(g+1)*d;y++)for(var _=Math.abs(v-(y+.5))/u,b=(f+.5)*c,x=_*_,T=Math.floor(f*c);T<(f+1)*c;T++){var W=Math.abs(b-(T+.5))/s,C=Math.sqrt(x+W*W);C>=-1&&C<=1&&(m=2*C*C*C-3*C*C+1)>0&&(w+=m*e[W=4*(T+y*i)],gx_g+=m*e[W+1],gx_b+=m*e[W+2],gx_a+=m*e[W+3],p+=m)}n[l]=w/p,n[l+1]=gx_g/p,n[l+2]=gx_b/p,n[l+3]=gx_a/p}return h.data.buffer}}),Object.create(t)});